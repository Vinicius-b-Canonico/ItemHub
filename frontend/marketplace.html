<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Marketplace • ItemHub</title>
  <!-- ========================= -->
  <!--        FAVICONS           -->
  <!-- ========================= -->
  <link rel="icon" href="/favicon.ico">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/web-app-manifest-192x192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="/web-app-manifest-512x512.png">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">

  <link rel="stylesheet" href="css/style.css" />

  <style>
    /* Chips pequenos ao lado do título */
    .chip-small {
      background: var(--ih-primary);
      color: white;
      font-size: 0.75rem;
      padding: 0.25rem 0.5rem;
      border-radius: 1rem;
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
    }
    .chip-small button {
      background: none;
      border: none;
      color: white;
      font-size: 1rem;
      line-height: 1;
      padding: 0;
      cursor: pointer;
      opacity: 0.9;
    }
    .chip-small button:hover { opacity: 1; }

    /* Sugestões */
    .suggestions {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: white;
      border: 1px solid var(--ih-gray-200);
      border-radius: var(--ih-radius);
      max-height: 220px;
      overflow-y: auto;
      z-index: 1050;
      box-shadow: var(--ih-shadow-lg);
      margin-top: 0.25rem;
    }
    .suggestions div {
      padding: 0.75rem 1rem;
      cursor: pointer;
    }
    .suggestions div:hover { background: var(--ih-gray-100); }

    /* Ajustes do accordion */
    .accordion-button {
      font-weight: 600;
      background: var(--ih-gray-100);
      border-radius: var(--ih-radius) !important;
    }
    .accordion-button:not(.collapsed) {
      background: var(--ih-primary);
      color: white;
      box-shadow: none;
    }
    .accordion-button::after {
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%23ffffff'%3e%3cpath fill-rule='evenodd' d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3e%3c/svg%3e");
    }
    .accordion-button:not(.collapsed)::after {
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%23ffffff'%3e%3cpath fill-rule='evenodd' d='M7.646 4.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1-.708.708L8 5.707l-5.646 5.647a.5.5 0 0 1-.708-.708l6-6z'/%3e%3c/svg%3e");
    }
  </style>
</head>
<body class="pb-5">

<div class="container-fluid py-4 py-md-5">
  <div class="row g-4 g-xl-5">

    <!-- ========== SIDEBAR (Desktop) ========== -->
    <div class="col-lg-3">
      <div id="filters-sidebar" class="bg-white rounded shadow-sm p-4 sticky-top" style="top: 90px;">
        <h5 class="mb-4 fw-bold">Filtros</h5>

        <form id="filters-form">
          <div class="accordion" id="filtersAccordion">

            <!-- Busca Livre -->
            <div class="accordion-item border-0 mb-3">
              <h2 class="accordion-header">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-search">
                  Pesquisa
                </button>
              </h2>
              <div id="collapse-search" class="accordion-collapse collapse show" data-bs-parent="#filtersAccordion">
                <div class="accordion-body pt-3">
                  <input type="text" id="search-input" class="form-control" placeholder="Ex: sofá, bicicleta, geladeira..." autocomplete="off">
                </div>
              </div>
            </div>

            <!-- Tipo de Oferta -->
            <div class="accordion-item border-0 mb-3">
              <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-type">
                  Tipo de Oferta
                </button>
              </h2>
              <div id="collapse-type" class="accordion-collapse collapse" data-bs-parent="#filtersAccordion">
                <div class="accordion-body pt-3">
                  <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" id="type-free">
                    <label class="form-check-label" for="type-free">
                      <span class="badge badge-free me-2">GRÁTIS</span> Grátis
                    </label>
                  </div>
                  <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" id="type-pay">
                    <label class="form-check-label" for="type-pay">
                      <span class="badge badge-pay me-2">À VENDA</span> À Venda
                    </label>
                  </div>
                  <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" id="type-paid_to_take">
                    <label class="form-check-label" for="type-paid_to_take">
                      <span class="badge badge-paid-to-take me-2">PAGO PRA LEVAR</span> Pago pra Levar
                    </label>
                  </div>
                </div>
              </div>
            </div>

            <!-- Categorias -->
            <div class="accordion-item border-0 mb-3">
              <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-categories">
                  Categorias
                </button>
              </h2>
              <div id="collapse-categories" class="accordion-collapse collapse" data-bs-parent="#filtersAccordion">
                <div class="accordion-body pt-3">
                  <div class="d-flex justify-content-between align-items-center mb-2">
                    <label class="form-label fw-medium mb-0">Selecionadas</label>
                    <div id="selected-categories-chips"></div>
                  </div>
                  <div class="position-relative">
                    <input type="text" id="category-search" class="form-control" placeholder="Digite para buscar categoria..." autocomplete="off">
                    <div id="category-suggestions" class="suggestions d-none"></div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Localização -->
            <div class="accordion-item border-0 mb-3">
              <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-location">
                  Localização
                </button>
              </h2>
              <div id="collapse-location" class="accordion-collapse collapse" data-bs-parent="#filtersAccordion">
                <div class="accordion-body pt-3">
                  <div class="form-check mb-3">
                    <input class="form-check-input" type="checkbox" id="nationwide">
                    <label class="form-check-label fw-bold text-primary" for="nationwide">Todo o Brasil</label>
                  </div>

                  <div class="mb-3">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                      <label class="form-label fw-medium mb-0">Estados</label>
                      <div id="selected-states-chips"></div>
                    </div>
                    <div class="position-relative">
                      <input type="text" id="state-search" class="form-control" placeholder="Digite o nome do estado..." autocomplete="off">
                      <div id="state-suggestions" class="suggestions d-none"></div>
                    </div>
                  </div>

                  <div id="specific-cities-wrapper" class="d-none">
                    <div class="form-check mb-3">
                      <input class="form-check-input" type="checkbox" id="filter-specific-cities">
                      <label class="form-check-label fw-medium" for="filter-specific-cities">
                        Filtrar apenas cidades específicas
                      </label>
                    </div>
                    <div id="cities-input-wrapper" class="d-none">
                      <div class="d-flex justify-content-between align-items-center mb-2">
                        <label class="form-label fw-medium mb-0">Cidades</label>
                        <div id="selected-cities-chips"></div>
                      </div>
                      <div class="position-relative">
                        <input type="text" id="city-search" class="form-control" placeholder="Digite o nome da cidade..." autocomplete="off">
                        <div id="city-suggestions" class="suggestions d-none"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

          </div>

          <!-- Botões -->
          <div class="d-flex flex-column gap-2 mt-4">
            <button type="submit" class="btn btn-primary fw-bold">Aplicar Filtros</button>
            <button type="button" id="clear-filters" class="btn btn-outline-secondary">Limpar Tudo</button>
          </div>
        </form>
      </div>
    </div>

    <!-- ========== CONTEÚDO PRINCIPAL ========== -->
    <div class="col-lg-9">
      <div class="d-flex flex-wrap justify-content-between align-items-center mb-4 gap-3">

        <div id="results-info" class="text-muted fw-medium">Carregando...</div>
        <select id="sort-select" class="form-select" style="width:auto;">
          <option value="newest">Mais recentes</option>
          <option value="distance">Mais próximos</option>
          <option value="relevance">Mais relevantes</option>
        </select>
      </div>

      <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-3 row-cols-xl-4 g-4" id="items-grid"></div>

      <div id="loading" class="text-center py-5">
        <div class="spinner-border text-primary" style="width:3rem;height:3rem;"></div>
      </div>

      <div id="no-results" class="text-center py-5 text-muted d-none">
        <p class="mt-3 fs-5">Nenhum item encontrado.</p>
      </div>

      <nav class="mt-5">
        <ul class="pagination justify-content-center" id="pagination"></ul>
      </nav>
    </div>
  </div>
</div>

<div id="offersModalContainer"></div>
<div id="resultModalsContainer"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script type="module" src="js/pages/marketplace/marketplace.js"></script>
</body>
</html>