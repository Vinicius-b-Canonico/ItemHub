<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Item Details</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">

  <style>
    /* Existing styles (unchanged) */
    .image-viewer { position: relative; display: flex; justify-content: center; align-items: center; background:#fff; border-radius:8px; padding:12px; min-height:320px; }
    .image-viewer img.main-image { max-height:420px; width:auto; max-width:100%; object-fit:contain; border-radius:6px; transition:opacity 160ms ease; }
    .viewer-arrow { position:absolute; top:50%; transform:translateY(-50%); width:44px; height:44px; border-radius:6px; display:flex; justify-content:center; align-items:center; background:rgba(255,255,255,0.92); box-shadow:0 2px 6px rgba(0,0,0,0.08); cursor:pointer; z-index:10; }
    .viewer-arrow.disabled { opacity:0.35; pointer-events:none; }
    .viewer-arrow.left { left:8px; } .viewer-arrow.right { right:8px; }
    .thumbnails { display:flex; gap:8px; overflow-x:auto; padding-top:10px; align-items:center; }
    .thumb { position:relative; width:80px; height:60px; flex:0 0 auto; border-radius:6px; overflow:hidden; cursor:pointer; border:2px solid transparent; }
    .thumb img { width:100%; height:100%; object-fit:cover; }
    .thumb.active { border-color:#0d6efd; }
    .thumb .del-btn { position:absolute; top:3px; right:3px; background:rgba(255,255,255,0.9); border-radius:4px; padding:2px 4px; font-size:12px; display:none; }
    .thumb.edit-mode .del-btn { display:block; }
    .no-image-placeholder { color:#6c757d; font-size:14px; text-align:center; }

    /* REQUIRED FOR AUTOCOMPLETE */
    .location-wrapper {
      position: relative;
    }
    .suggestions {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      z-index: 1050;
      max-height: 200px;
      overflow-y: auto;
      background: white;
      border: 1px solid #ced4da;
      border-radius: 0.375rem;
      margin-top: 2px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      display: none;
    }
    .suggestions div {
      padding: 10px 12px;
      cursor: pointer;
      font-size: 14px;
    }
    .suggestions div:hover,
    .suggestions div.active {
      background: #0d6efd;
      color: white;
    }
  </style>
</head>
<body class="bg-light">
  <div id="navbarContainer"></div>

  <div class="container mt-4">
    <h3 id="page-title" class="mb-4">Item Details</h3>

    <!-- Image viewer (unchanged) -->
    <div id="image-viewer-wrapper" class="mb-4">
      <div id="imageViewer" class="image-viewer">
        <div id="prevBtn" class="viewer-arrow left" title="Previous"><i class="bi bi-chevron-left"></i></div>
        <img id="mainImage" class="main-image d-none" alt="Item image">
        <div id="noImagePlaceholder" class="no-image-placeholder">No images available</div>
        <div id="nextBtn" class="viewer-arrow right" title="Next"><i class="bi bi-chevron-right"></i></div>
      </div>
      <div id="thumbnails" class="thumbnails mt-3"></div>
    </div>

    <form id="item-form" class="mt-3 bg-white p-4 rounded shadow-sm">

      <!-- Images -->
      <div class="mb-4">
        <label for="images" class="form-label fw-semibold">Images</label>
        <input type="file" id="images" class="form-control" accept="image/*" multiple>
        <div class="form-text">You can select multiple images. Use thumbnails to reorder/delete before saving.</div>
      </div>

      <!-- Title & Category -->
      <div class="row">
        <div class="col-md-6 mb-3">
          <label for="title" class="form-label">Title</label>
          <input type="text" id="title" class="form-control" required>
        </div>
        <div class="col-md-6 mb-3">
          <label for="category" class="form-label">Category</label>
          <select id="category" class="form-select" required><option value="">Loading...</option></select>
        </div>
      </div>

      <!-- Duration, Offer Type, Volume -->
      <div class="row">
        <div class="col-md-4 mb-3">
          <label for="duration_days" class="form-label">Duration (days)</label>
          <select id="duration_days" class="form-select" required>
            <option value="1">1 day</option>
            <option value="7">7 days</option>
            <option value="15">15 days</option>
            <option value="30">30 days</option>
          </select>
        </div>
        <div class="col-md-4 mb-3">
          <label for="offer_type" class="form-label">Offer Type</label>
          <select id="offer_type" class="form-select">
            <option value="pay">Pay</option>
            <option value="free">Free</option>
            <option value="paid_to_take">Paid to Take</option>
          </select>
        </div>
        <div class="col-md-4 mb-3">
          <label for="volume" class="form-label">Volume</label>
          <input type="number" id="volume" class="form-control">
        </div>
      </div>

      <!-- LOCATION FIELDS — FIXED -->
      <div class="mb-4">
        <label class="form-label fw-semibold">Localização *</label>

        <div class="location-wrapper mb-3">
          <label for="state" class="form-label">Estado</label>
          <input type="text" id="state" class="form-control" placeholder="Digite para buscar o estado..." autocomplete="off" required>
          <div id="state-suggestions" class="suggestions"></div>
        </div>

        <div class="location-wrapper mb-3">
          <label for="city" class="form-label">Cidade</label>
          <input type="text" id="city" class="form-control" placeholder="Primeiro escolha o estado" autocomplete="off" disabled required>
          <div id="city-suggestions" class="suggestions"></div>
        </div>

        <div class="mb-3">
          <label for="address" class="form-label">Endereço completo (rua, número, bairro...)</label>
          <input type="text" id="address" class="form-control" placeholder="Ex: Av. Paulista, 1000 - Bela Vista" required>
        </div>
      </div>

      <!-- Description -->
      <div class="mb-3">
        <label for="description" class="form-label">Description</label>
        <textarea id="description" class="form-control" rows="3"></textarea>
      </div>

      <!-- Buttons -->
      <div id="button-group" class="d-flex gap-2 mt-4">
        <button type="submit" id="save-btn" class="btn btn-primary">Save</button>
        <button type="button" id="delete-btn" class="btn btn-danger d-none">Delete</button>
        <button type="button" id="cancel-btn" class="btn btn-secondary">Cancel</button>
      </div>
    </form>

    <div id="alertContainer" class="mt-3"></div>
  </div>

  <div id="offersModalContainer"></div>
  <div id="resultModalsContainer"></div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script type="module" src="../js/components/offersModals.js"></script>
  <script type="module" src="../js/pages/itemDetails/itemDetails.js"></script>
</body>
</html>